<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UFO Sightings Explorer — Maps & Multi‑View (Vega‑Lite)</title>
  <meta name="description" content="Interactive Vega‑Lite story about UFO sightings: top cities map, hourly pattern (radial), monthly trend, and shape composition by year." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Vega libs -->
<script src="https://unpkg.com/vega@5"></script>
<script src="https://unpkg.com/vega-lite@5"></script>
<script src="https://unpkg.com/vega-embed@6"></script>

  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --ink:#e5e7eb; --muted:#9ca3af; --brand:#38bdf8; --accent:#a78bfa;
    }
    html,body{margin:0;height:100%;background:radial-gradient(1200px 800px at 10% -10%, #1f2937 0%, var(--bg) 40%);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .container{max-width:1100px;margin-inline:auto;padding:24px;}
    header.site{position:sticky;top:0;z-index:1000;backdrop-filter: blur(8px);background:color-mix(in oklab,var(--bg), transparent 40%);border-bottom:1px solid #1f2937;}
    header .bar{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 24px;}
    .brand{font-family:"Playfair Display",serif;font-weight:700;letter-spacing:.2px}
    .brand .pill{display:inline-block;padding:.25rem .6rem;border:1px solid #334155;border-radius:999px;color:var(--muted);font-size:.85rem;margin-left:.5rem}
    nav a{color:var(--muted);text-decoration:none;margin-left:16px;font-size:.95rem}
    nav a:hover{color:var(--ink)}
    .hero{display:grid;grid-template-columns:1.3fr .7fr;gap:28px;align-items:end;padding:32px 0 8px}
    .hero h1{font:700 40px/1.1 "Playfair Display",serif;margin:0;color:white}
    .hero p{color:var(--muted);margin:10px 0 0;max-width:60ch}
    .tag{display:inline-block;background:#0b1220;border:1px solid #1f2937;border-radius:999px;padding:.35rem .7rem;font-size:.8rem;color:var(--brand)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-top:20px}
    .card{background:linear-gradient(180deg,#101827,#0b1220);border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.45);overflow:hidden}
    .card header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #1f2937}
    .card header h2{font:600 18px/1.2 Inter,system-ui;margin:0;color:#fff}
    .card header .small{color:var(--muted);font-size:.85rem}
    .card .body{padding:14px 16px}
    .vis{min-height:360px}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    .kpi{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:10px 12px}
    .kpi .label{color:var(--muted);font-size:.75rem}
    .kpi .value{font-weight:700;font-size:1.2rem}
    .notes{margin:24px 0}
    details{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:10px 14px}
    summary{cursor:pointer;color:var(--ink);font-weight:600}
    .meta{color:var(--muted);font-size:.9rem}
    footer{margin:24px 0 60px;color:var(--muted);font-size:.85rem}
    code{background:#0b1220;border:1px solid #1f2937;border-radius:6px;padding:2px 6px}
    a{color:var(--brand)}
    @media (max-width: 880px){ .hero{grid-template-columns:1fr} .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header class="site">
    <div class="bar container">
      <div class="brand">UFO Sightings Explorer<span class="pill">Vega‑Lite · Map + Multi‑view</span></div>
      <nav>
        <a href="#map">Map</a>
        <a href="#time">Time</a>
        <a href="#meta">Data & Credits</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div>
        <div class="tag">UFO dataset · cleaned + aggregated</div>
        <h1>Where and when do UFO sightings cluster?</h1>
        <p>This page uses a symbol map, an hourly radial chart, a monthly trend line, and a yearly shape composition to communicate patterns in UFO sightings. All visuals are simple, readable, and use the same dark aesthetic; interactivity is deliberately minimal to keep the narrative focused.</p>
      </div>
      <div class="kpis">
        <div class="kpi"><div class="label">Peak month count</div><div id="kpi1" class="value">—</div></div>
        <div class="kpi"><div class="label">Months covered</div><div id="kpi2" class="value">—</div></div>
        <div class="kpi"><div class="label">Peak month</div><div id="kpi3" class="value">—</div></div>
        <div class="kpi"><div class="label">Total sightings</div><div id="kpi4" class="value">—</div></div>
      </div>
    </section>

    <section id="map" class="grid">
      <article class="card">
        <header>
          <h2>Top cities map (symbol size = sightings)</h2>
          <span class="small">Projection = Equal Earth · Hover for details</span>
        </header>
        <div id="symbolVis" class="body vis"></div>
      </article>

      <article class="card">
        <header>
          <h2>Sightings by hour (radial)</h2>
          <span class="small">Donut arc · 0–23h</span>
        </header>
        <div id="hourVis" class="body vis"></div>
      </article>
    </section>

    <section id="time" class="grid">
      <article class="card">
        <header>
          <h2>Monthly trend of sightings</h2>
          <span class="small">Line with points · Hover for values</span>
        </header>
        <div id="trendVis" class="body vis"></div>
      </article>

      <article class="card">
        <header>
          <h2>Shape composition by year</h2>
          <span class="small">Normalized stacked bars (top 6 + Other)</span>
        </header>
        <div id="stackVis" class="body vis"></div>
      </article>
    </section>

    <section id="meta" class="notes">
      <details open>
        <summary>Data, authorship & credits</summary>
        <p class="meta">
          <strong>Author:</strong> Your Name · <strong>Date:</strong> 14 Oct 2025 · <strong>License:</strong> CC BY 4.0 (visuals) · Code MIT<br>
          <strong>Data:</strong> Derived from <code>scrubbed.csv</code> (UFO sightings) via preprocessing (see repo). Aggregates: <code>ufo_top_cities.csv</code>, <code>ufo_hour.csv</code>, <code>ufo_monthly.csv</code>, <code>ufo_shape_year.csv</code>.
        </p>
        <ul class="meta">
          <li><strong>Why</strong>: Summarise spatiotemporal clusters to support pattern discussion.</li>
          <li><strong>Idioms</strong>: Symbol map for geospatial hotspots; radial for cyclic hour; line for temporal trend; stacked bars for composition.</li>
          <li><strong>Audience</strong>: General public; tooltips and gentle color are used for clarity.</li>
        </ul>
      </details>
    </section>

    <footer>
      Built with <code>Vega‑Lite 5</code>. To deploy as GitHub Pages: push as <code>index.html</code>, enable Pages. Place CSVs in <code>/data</code> (see below specs).
    </footer>
  </main>

  <!-- ===== Specs ===== -->
  <script>
    // 1) Symbol map: /data/ufo_top_cities.csv (city,state,country,latitude,longitude,count)
    const symbolSpec = {
      $schema:'https://vega.github.io/schema/vega-lite/v5.json',
      width:520, height:360, projection:{type:'equalEarth'},
      layer:[
        {data:{ url:'https://vega.github.io/vega/data/world-110m.json', format:{type:'topojson', feature:'countries'}},
         mark:{type:'geoshape', fill:'#0b1220', stroke:'#1f2937'}},
        {data: { url: 'data/ufo_top_cities.csv' },
         mark:{type:'circle', opacity:0.9},
         encoding:{
           longitude:{field:'longitude', type:'quantitative'},
           latitude:{field:'latitude', type:'quantitative'},
           size:{field:'count', type:'quantitative', title:'Sightings', scale:{range:[40,900]}},
           color:{field:'city', type:'nominal', legend:null, scale:{scheme:'tableau10'}},
           tooltip:[
             {field:'city'},{field:'state'},{field:'country'},
             {field:'count', type:'quantitative', title:'Sightings'}
           ]
         }}
      ]
    };

    // 2) Hour radial: /data/ufo_hour.csv (hour,count)
    const hourSpec = {
      $schema:'https://vega.github.io/schema/vega-lite/v5.json',
      width:520, height:360,
      data:{ url:'data/ufo_hour.csv' },
      transform:[{calculate:'format(datum.hour, "02")', as:'hlabel'}],
      mark:{type:'arc', innerRadius:80, stroke:'#0b1220'},
      encoding:{
        theta:{field:'count', type:'quantitative', stack:true},
        color:{field:'hlabel', type:'nominal', legend:{title:'Hour (00–23)'}},
        tooltip:[{field:'hour', title:'Hour (0–23)'},{field:'count', type:'quantitative'}]
      }
    };

    // 3) Monthly trend: /data/ufo_monthly.csv (month,count)
    const trendSpec = {
      $schema:'https://vega.github.io/schema/vega-lite/v5.json',
      width:980, height:280,
      data:{ url:'data/ufo_monthly.csv' },
      mark:{type:'line', point:true},
      encoding:{
        x:{field:'month', type:'temporal', title:'Month'},
        y:{field:'count', type:'quantitative', title:'Sightings'},
        color:{value:'#38bdf8'},
        tooltip:[{field:'month', type:'temporal'},{field:'count', type:'quantitative'}]
      }
    };

    // 4) Shapes by year: /data/ufo_shape_year.csv (year,shape,share)
    const stackSpec = {
      $schema:'https://vega.github.io/schema/vega-lite/v5.json',
      width:520, height:360,
      data: { url: 'data/ufo_shape_year.csv' },
      mark:{type:'bar'},
      encoding:{
        x:{field:'year', type:'ordinal', title:'Year'},
        y:{field:'share', type:'quantitative', stack:'normalize', title:'Shape share'},
        color:{field:'shape', type:'nominal', title:'UFO shape'},
        tooltip:[{field:'year'},{field:'shape'},{field:'share', type:'quantitative'}]
      }
    };

    vegaEmbed('#symbolVis', symbolSpec, {actions:false});
    vegaEmbed('#hourVis', hourSpec, {actions:false});
    vegaEmbed('#trendVis', trendSpec, {actions:false});
    vegaEmbed('#stackVis', stackSpec, {actions:false});

    // KPI loader from monthly CSV
    <!-- KPI loader from monthly CSV (robust parsing) -->
<script>
async function loadKpis(){
  const text = await fetch('data/ufo_monthly.csv').then(r=>r.text());

  // robust parsing: handles CRLF/LF, extra spaces, blank lines
  const rows = text.trim().split(/\r?\n/).filter(Boolean);
  const header = rows.shift().split(',').map(s => s.trim());
  const idxMonth = header.findIndex(h => /^month$/i.test(h));
  const idxCount = header.findIndex(h => /^count$/i.test(h));

  const data = rows.map(r => {
    const c = r.split(',');
    const month = (c[idxMonth] || '').trim();
    const count = parseFloat((c[idxCount] || '0').trim()) || 0;
    return { month, count };
  }).filter(d => d.month);

  const total = data.reduce((a,d)=>a+d.count,0);
  const max = Math.max(...data.map(d=>d.count));
  const peak = data.reduce((a,b)=> (b.count>a.count? b : a));

  document.getElementById('kpi1').textContent = max;
  document.getElementById('kpi2').textContent = data.length + ' months';
  document.getElementById('kpi3').textContent = peak.month;
  document.getElementById('kpi4').textContent = total;
}
loadKpis();
</script>

  </script>
</body>
</html>
